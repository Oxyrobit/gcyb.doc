---
slug: excercice
title: S'exercer
sidebar_position: 3
---

Le script affichera un message d'accueil: "Liste des services".

Le script devra tester la présence du dossier Logs_Services dans E:\ TP_Powershell et le créer si nécessaire.

Le script devra traiter tous les services de la machine.

Si le service est démarré, afficher: " le service xx  est bien démarré ! " en vert.

Exporter le nom du service, le nom d'affichage et son statut sous la forme: Nom du service  ||  Nom d'affichage  ||  Statut  vers un fichier nommé :  Services_Running.txt.

Au début du fichier d'export le texte : "Journal des services démarrés du: GDH" doit apparaitre.

Si le service n'est pas démarré, afficher: " le service xx  n'est pas démarré ! " en rouge.

Exporter le nom du service, le nom d'affichage et son statut sous la forme: Nom du service  ||  Nom d'affichage  ||  Statut  vers un fichier nommé :  Services_Not_Running.txt.

Au début du fichier d'export le texte : "Journal des services stoppés du: GDH" doit apparaitre.

A la fin du script, un compteur affichera le nombre de services démarrés en jaune et le nombre de services arrêtés en rouge.

<details>
  <summary>Correction</summary>

        ```Powershell
        Clear-Host

        $rootDirectory = "E:\TP-Ps"
        $logsFolder = "Log_Services"

        $RunningFile = "$rootDirectory\$logsFolder\Services_Running.txt"
        $stoppedFile = "$rootDirectory\$logsFolder\Services_Not_Running.txt"


        if (-Not(Test-Path $rootDirectory\$logsFolder)){
            Write-Host "Creation du dossier $logsFolder"
            New-Item -ItemType Directory -Name Log_Services -Path $rootDirectory
        }

        Set-Content -Path $RunningFile -Value "Journal des services démarré du: GDH"
        Set-Content -Path $stoppedFile -Value "Journal des services stoppés du: GDH"

        $listServices = Get-Service | Select Name, DisplayName, Status

        $stoppedCount = 0
        $startedCount = 0
        foreach ($service in $listServices)
        {
            $logValue = "$($service.Name) || $($service.DisplayName) || $($service.Status)"

            Switch($service.Status) {
                "Running" { 
                    Write-Host "Le service $($service.Name) est bien démarré." -ForegroundColor DarkGreen
                    Add-Content -Path $RunningFile -Value $logValue
                    $startedCount++
                }
                "Stopped" {
                    Write-Host "Le service $($service.Name) n'est pas démarré." -ForegroundColor DarkRed
                    Add-Content -Path $stoppedFile -Value $logValue
                    $stoppedCount++
                }
                Default {

                    Echo "Aucun des deux"
                }
            }
            
        }

        Write-Host "Il y a services $($startedCount) démarré" -ForegroundColor Yellow
        Write-Host "Et services $($stoppedCount) arrêté" -ForegroundColor Red
        ```

</details>